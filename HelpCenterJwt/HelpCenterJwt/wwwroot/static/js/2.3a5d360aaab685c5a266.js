webpackJsonp([2,19],{"5Eks":function(e,t){},"8ieG":function(e,t){},GPdW:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={props:{userRoleForm:{},formProps:{type:Object,default:function(){return{method:void 0}}}},mounted:function(){this.loadRowData()},data:function(){return{uRForm:{}}},methods:{loadRowData:function(e){var t=this,o=e||this.formProps.roleId;this.$axios.get("/api/Role",{params:{roleId:o}}).then(function(e){e.data.result&&(t.uRForm=e.data.data,console.log(t.uRForm))}).catch(function(e){console.log("DepartPeopleFrom的loadRowData方法catch到异常了"),console.log(e)})},onSubmit:function(){var e=this;if("post"===this.formProps.methods){var t=this,o=this.uRForm;t.$axios.post("/api/Role",o).then(function(o){var a=o.data;0==a.result?t.$message.error(a.tips):(t.$message({message:a.tips,type:"success"}),e.$emit("UrFormAddSuccess"))}).catch(function(e){console.log(e)})}if("put"===this.formProps.methods){var a=this;a.$axios.put("api/Role?roleId="+this.formProps.roleId,this.uRForm).then(function(t){var o=t.data;0==o.result?(a.$message.error(o.tips),e.$emit("UrFormAddSuccess")):(a.$message({message:t.data.tips,type:"success"}),e.$emit("UrFormAddSuccess"))}).catch(function(e){console.log(e)})}},onUrfSubmit:function(){},modifyUrfSubmit:function(){},URloadData:function(e){},urClose:function(){this.$emit("urClose")},resetForm:function(){this.$refs.form.resetFields()}},watch:{}},i={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-form",{ref:"form",attrs:{model:e.uRForm,"label-width":"70px"}},[o("el-form-item",{attrs:{label:"角色"}},[o("el-input",{model:{value:e.uRForm.roleName,callback:function(t){e.$set(e.uRForm,"roleName",t)},expression:"uRForm.roleName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"角色描述"}},[o("el-input",{attrs:{type:"textarea"},model:{value:e.uRForm.roleRemark,callback:function(t){e.$set(e.uRForm,"roleRemark",t)},expression:"uRForm.roleRemark"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"状态"}},[o("el-radio-group",{model:{value:e.uRForm.roleState,callback:function(t){e.$set(e.uRForm,"roleState",t)},expression:"uRForm.roleState"}},[o("el-radio",{attrs:{label:1}},[e._v("启用")]),e._v(" "),o("el-radio",{attrs:{label:0}},[e._v("禁用")])],1)],1),e._v(" "),o("el-form-item",{staticStyle:{"text-align":"right"}},[o("el-button",{on:{click:e.urClose}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确 定")])],1)],1)},staticRenderFns:[]};var r=o("C7Lr")(a,i,!1,function(e){o("VEjT")},"data-v-b03f9734",null).exports,s=o("aA9S"),l=o.n(s),n={mounted:function(){this.loadUrtData()},props:{modifyVisible:"",resetVisible:""},components:{xyAuthorization:o("wYWi").default},data:function(){return{selectionCol:!1,tableData:[],userRoleForm:{},currentPage:1,pageTotal:0,pageSize:10,authVisible:!1,roleMsg:""}},computed:{},methods:{loadUrtData:function(e){var t=this,o=l()({},{rowCount:t.pageSize,pageIndex:t.currentPage},e);this.$axios.get("/api/Role/pagelist",{params:o}).then(function(e){var o=e.data.data;o.info.forEach(function(e){1===e.roleState?e.roleState="启用":0===e.roleState&&(e.roleState="禁用")}),t.tableData=o.info,t.pageTotal=o.totalCount})},handleCurrentChange:function(e){this.currentPage=e,this.loadUrtData()},handleModify:function(e,t){this.$emit("modifyVisibleChange",t)},handleDelete:function(e){var t=this,o=this;this.$confirm("你真的删除这个角色吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){o.$axios.delete("api/Role?roleId="+e.roleId).then(function(e){var a=e.data;console.log(e),!1===e.result?o.$message.error(a.tips):(o.$message(a.tips),t.loadUrtData())})})},handleDisable:function(e){var t=this,o=this;"禁用"==e.roleState?e.roleState=1:e.roleState=0,o.$axios.put("api/Role/enable/roleid?roleId="+e.roleId+"&roleState="+e.roleState).then(function(e){o.$message({message:e.data.tips,type:"success"}),t.loadUrtData()}).catch(function(e){console.log(e)})},authorization:function(e,t){var o=this;this.authVisible=!0,this.roleMsg=t,setTimeout(function(){o.$refs.authorizationTree.resetChecked(),o.$refs.authorizationTree.LoadRoleModule(o.roleMsg.roleId)},10)},authorizationClose:function(){this.authVisible=!1}},watch:{},beforeDestroy:function(){}},u={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("el-table",{ref:"multipleTable",staticClass:"table",attrs:{data:e.tableData,border:""}},[o("el-table-column",{attrs:{prop:"crdt",label:"创建时间",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"roleName",label:"角色名称",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"crUsrName",label:"创建人",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"roleState",label:"状态",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"updt",label:"修改时间",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"upUsrName",label:"修改人",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{label:"操作",width:"280",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"text"},on:{click:function(o){e.handleModify(t.$index,t.row)}}},[e._v("修改")]),e._v(" "),o("el-button",{attrs:{type:"text"},on:{click:function(o){e.authorization(t.$index,t.row)}}},[e._v("授权")]),e._v(" "),o("el-button",{staticClass:"red",attrs:{type:"text"},on:{click:function(o){e.handleDelete(t.row)}}},[e._v("删除")]),e._v(" "),o("el-button",{staticClass:"red",attrs:{type:"text"},on:{click:function(o){e.handleDisable(t.row)}}},[e._v("禁用")])]}}])})],1),e._v(" "),o("el-dialog",{attrs:{title:"授权",visible:e.authVisible,width:"30%"},on:{"update:visible":function(t){e.authVisible=t}}},[o("xy-authorization",{ref:"authorizationTree",attrs:{roleMsg:e.roleMsg},on:{authorizationClose:e.authorizationClose}})],1),e._v(" "),o("div",{staticClass:"pagination"},[o("el-pagination",{attrs:{"page-size":e.pageSize,layout:"total, prev, pager, next",total:e.pageTotal},on:{"current-change":e.handleCurrentChange}})],1)],1)},staticRenderFns:[]};var c={name:"roleMange",data:function(){var e=this;return{formProps:{method:"put"},tip:"",tableData:[],cur_page:1,multipleSelection:[],select_cate:"",select_word:"",del_list:[],is_search:!1,modifyVisible:!1,addVisible:!1,resetVisible:!1,delVisible:!1,userRoleForm:{},idx:-1,ruleForm2:{pass:"",checkPass:"",age:""},rules2:{pass:[{validator:function(t,o,a){""===o?a(new Error("请输入密码")):(""!==e.ruleForm2.checkPass&&e.$refs.ruleForm2.validateField("checkPass"),a())},trigger:"blur"}],checkPass:[{validator:function(t,o,a){""===o?a(new Error("请再次输入密码")):o!==e.ruleForm2.pass?a(new Error("两次输入密码不一致!")):a()},trigger:"blur"}]}}},mounted:function(){},created:function(){},components:{xyUserRoleForm:r,xyUserRoleTable:o("C7Lr")(n,u,!1,function(e){o("8ieG")},"data-v-213fd6aa",null).exports},computed:{data:function(){}},methods:{addRm:function(){this.tip="新增角色",this.formProps.methods="post",this.addVisible=!0,this.$refs.urForm&&this.$refs.urForm.resetForm()},modifyVisibleFun:function(e){this.tip="修改角色",this.formProps=e,this.formProps.methods="put",this.$refs.urForm&&this.$refs.urForm.loadRowData(e.roleId),this.addVisible=!0},urClose:function(){this.addVisible=!1},UrFormAddSuccess:function(){this.$refs.rmTable.loadUrtData(),this.addVisible=!1},onUrfSubmit:function(){this.$refs.rmAdd.onUrfSubmit(),this.addVisible=!1},resetVisibleFun:function(e){this.resetVisible=e},handleCurrentChange:function(e){this.cur_page=e},getUrtData:function(e){this.userRoleForm=e},search:function(){this.is_search=!0},filterTag:function(e,t){return t.tag===e},handleEdit:function(e,t){this.idx=e;var o=this.tableData[e];this.userRoleForm=o,this.editVisible=!0},handleModify:function(){this.modifyVisible=!0},handleDelete:function(e,t){this.idx=e,this.delVisible=!0},handleDisable:function(){},handleSelectionChange:function(e){this.multipleSelection=e},delAll:function(){var e=this.multipleSelection.length,t="";this.del_list=this.del_list.concat(this.multipleSelection);for(var o=0;o<e;o++)t+=this.multipleSelection[o].name+" ";this.$message.error("删除了"+t),this.multipleSelection=[]},deleteRow:function(){this.tableData.splice(this.idx,1),this.$message.success("删除成功"),this.delVisible=!1},submitForm:function(e){this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;alert("submit!")})},resetForm:function(e){this.$refs[e].resetFields()}}},d={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"table"},[o("div",{staticClass:"crumbs"},[o("el-breadcrumb",{attrs:{separator:"/"}},[o("el-breadcrumb-item",[o("i",{staticClass:"el-icon-lx-calendar"}),e._v(" 账户管理")]),e._v(" "),o("el-breadcrumb-item",[e._v("角色管理")])],1)],1),e._v(" "),o("div",{staticClass:"container"},[o("div",{staticClass:"handle-box"},[o("el-button",{staticClass:"handle-add",attrs:{type:"primary",icon:"add"},on:{click:function(t){e.addRm()}}},[e._v("新增")])],1),e._v(" "),o("xy-user-role-table",{ref:"rmTable",attrs:{userRoleForm:e.userRoleForm},on:{rmEvent:e.getUrtData,modifyVisibleChange:function(t){e.modifyVisibleFun(t)},resetVisibleChange:function(t){e.resetVisibleFun(t)}}})],1),e._v(" "),o("el-dialog",{attrs:{title:e.tip,visible:e.addVisible,width:"30%"},on:{"update:visible":function(t){e.addVisible=t}}},[o("xy-user-role-form",{ref:"urForm",attrs:{formProps:e.formProps,userRoleForm:e.userRoleForm},on:{UrFormAddSuccess:e.UrFormAddSuccess,urClose:e.urClose}})],1),e._v(" "),o("el-dialog",{attrs:{title:"提示",visible:e.delVisible,width:"300px",center:""},on:{"update:visible":function(t){e.delVisible=t}}},[o("div",{staticClass:"del-dialog-cnt"},[e._v("删除不可恢复，是否确定删除？")]),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.delVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.deleteRow}},[e._v("确 定")])],1)])],1)},staticRenderFns:[]};var f=o("C7Lr")(c,d,!1,function(e){o("5Eks")},"data-v-694ace84",null);t.default=f.exports},VEjT:function(e,t){},Yvry:function(e,t){},wYWi:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={mounted:function(){this.loadUrtData(),console.log(this.roleMsg.roleId)},props:{roleMsg:""},components:{},data:function(){return{roleName:"",pageIndex:1,rowCount:10,treeData:[],defaultProps:{children:"subs",label:"moduleName"},RoleModuleId:[]}},computed:{},methods:{loadUrtData:function(e){var t=this;t.$axios.get("api/SysModule/sysmoduletree").then(function(e){t.treeData=e.data.data})},LoadRoleModule:function(e){var t=this,o=[];this.$axios.get("api/RoleSysModule/roleid?roleId="+e).then(function(e){e.data.data.forEach(function(e,t){o.push(e.sysModuleId)}),t.RoleModuleId=o}).catch(function(e){console.log(e)})},authorizeCancel:function(){this.$emit("authorizationClose")},authorizeConfirm:function(){var e=this.$refs.tree.getCheckedKeys(),t=this.$refs.tree.getHalfCheckedKeys(),o=this,a={sysModuleIdList:e.concat(t),roleSysModuleState:1};o.$axios.post("api/RoleSysModule?roleId="+this.roleMsg.roleId,a).then(function(e){var t=e.data;0==t.result?o.$message.error(t.tips):o.$message({message:e.data.tips,type:"success"})}).catch(function(e){console.log(e)}),this.$emit("authorizationClose")},resetChecked:function(){this.$refs.tree.setCheckedKeys([])}},watch:{},beforeDestroy:function(){}},i={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"authorization-box"},[o("p",{staticClass:"p-title"},[e._v("授权的角色:"),o("span",[e._v(e._s(e.roleMsg.roleName))])]),e._v(" "),o("el-tree",{ref:"tree",attrs:{data:e.treeData,"show-checkbox":"","node-key":"moduleId","default-expand-all":"","default-checked-keys":e.RoleModuleId,props:e.defaultProps}}),e._v(" "),o("div",{staticClass:"authorization-footer"},[o("el-button",{on:{click:function(t){e.authorizeCancel()}}},[e._v("取消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.authorizeConfirm()}}},[e._v("确定")])],1)],1)},staticRenderFns:[]};var r=o("C7Lr")(a,i,!1,function(e){o("Yvry")},"data-v-2270726e",null);t.default=r.exports}});