webpackJsonp([3],{"8+FI":function(e,t,a){"use strict";var r=new(a("IvJb").default);t.a=r},Bz3Y:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={mounted:function(){this.DTreeloadData()},data:function(){return{treeData:[],tableData:[],crUsrId:"",defaultProps:{children:"child",label:"deptName"}}},props:{},methods:{DTreeloadData:function(){var e=this;this.$axios.get("api/Dept/me").then(function(t){e.treeData=t.data.data.detail}).catch(function(e){console.log(e)})},loadChild:function(e,t){if(e.parent)if(e.data.child&&0!==e.data.child.length)t(e.data.child);else{var a=this,r={deptId:e.data.deptId};a.$axios.get("api/Dept",{params:r}).then(function(e){0==e.result?a.$message.error(e.tips):t(e.data.data.childNodes)}).catch(function(e){console.log(e)})}},handleNodeClick:function(e,t,a){this.crUsrId=e.crUsrId,this.$emit("nodeClick",e,t,a)}}},s={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("el-tree",{ref:"tree",attrs:{"node-key":"deptId",data:this.treeData,props:this.defaultProps,lazy:"",load:this.loadChild},on:{"node-click":this.handleNodeClick}})],1)},staticRenderFns:[]};var o=a("C7Lr")(r,s,!1,function(e){a("UJ5+")},"data-v-68060c28",null).exports,i=a("aA9S"),n=a.n(i),l=(a("8+FI"),{mounted:function(){this.dmLoadTableData()},props:{modifyVisible:"",resetVisible:"",dminput:""},components:{},data:function(){return{selectionCol:!1,tableData:[],departForm:{preDeptName:"",preDeptId:"",deptName:"",deptAccount:"",deptPsw:""},judgePage:0,currentPage:1,pageTotal:0,pageSize:10,idx:-1}},computed:{},methods:{dmLoadTableData:function(e){var t=this,a=n()({},{rowCount:t.pageSize,pageIndex:t.currentPage},e);t.$axios.get("api/Dept/pagelist",{params:a}).then(function(e){var a=e.data.data;a.info.forEach(function(e){null===e.preDeptName&&(e.preDeptName="无上级部门")}),t.tableData=a.info,t.pageTotal=a.totalCount,t.judgePage=0}).catch(function(e){console.log(e)})},searchData:function(e,t){var a=this;a.judgePage=1,void 0!=e&&(a.dminput=e);var r=n()({},{rowCount:a.pageSize,pageIndex:1,deptName:a.dminput},t);this.$axios.get("api/Dept/keyword/deptname",{params:r}).then(function(e){var t=e.data.data;t.info.forEach(function(e){null===e.preDeptName&&(e.preDeptName="无上级部门")}),a.tableData=t.info,a.pageTotal=t.totalCount,a.judgePage=1}).catch(function(e){console.log(e)})},handleCurrentChange:function(e){this.currentPage=e,0==this.judgePage?this.dmLoadTableData():1==this.judgePage&&this.searchData()},handleModify:function(e,t){this.$emit("modifyVisibleChange",t)},handleModifyPass:function(e,t){this.$emit("resetVisibleChange",!0),this.idx=e;var a=this.tableData[e];this.departForm=a,this.$emit("dmEvent",this.departForm)},handleDelete:function(e){var t=this,a=this,r={deptId:e.deptId};console.log(r),this.$confirm("你真的删除这个部门吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$axios.delete("api/Dept",{params:r}).then(function(e){var r=e.data;console.log(e),!1===e.result?a.$message.error(r.tips):(a.$message(r.tips),t.dmLoadTableData())})})}},watch:{},beforeDestroy:function(){}}),d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-table",{ref:"multipleTable",staticClass:"table",attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{prop:"crdt",label:"创建时间",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"preDeptName",label:"上级部门名称",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"deptName",label:"部门名称",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"deptAccount",label:"账号",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"280",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){e.handleModify(t.$index,t.row)}}},[e._v("修改")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){e.handleModifyPass(t.$index,t.row)}}},[e._v("密码重置")]),e._v(" "),a("el-button",{staticClass:"red",attrs:{type:"text"},on:{click:function(a){e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{"page-size":e.pageSize,layout:"total, prev, pager, next",total:e.pageTotal},on:{"current-change":e.handleCurrentChange}})],1)],1)},staticRenderFns:[]};var c=a("C7Lr")(l,d,!1,function(e){a("pI/d")},"data-v-5f3c9eca",null).exports,p=a("oweW"),u={props:{departForm:{type:Object},formProps:{type:Object,default:function(){return{method:void 0}}}},mounted:function(){this.loadData(),this.getTreeSelectData()},components:{xyDepartTreeSelect:p.a},data:function(){return{departMsg:"",dfForm:{deptName:"",deptAccount:"",deptPsw:""},preSelectData:"",preSelectName:"",dfRules:{deptName:[{required:!0,message:"请输入部门名称",trigger:"blur"}],deptAccount:[{required:!0,message:"请输入部门账号",trigger:"blur"}],deptPsw:[{required:!0,message:"请输入密码",trigger:"blur"}]}}},methods:{loadData:function(e){var t=this,a=e||this.formProps.deptId;this.$axios.get("/api/Dept",{params:{deptId:a}}).then(function(e){e.data.result&&(t.dfForm=e.data.data.detail,t.departMsg=e.data.data.detail.preDeptId)}).catch(function(e){console.log("DepartFrom的loadData方法catch到异常了"),console.log(e)})},dTreeRowData:function(){var e=this,t=this.preSelectData;this.$axios.get("/api/Dept",{params:{deptId:t}}).then(function(t){t.data.result&&(e.preSelectName=t.data.data.detail.deptName)}).catch(function(e){console.log("DepartFrom的loadData方法catch到异常了"),console.log(e)})},getTreeSelectData:function(e){this.preSelectData=e,console.log(e)},onSubmit:function(){var e=this;if("post"===this.formProps.methods){var t=this,a=this.dfForm;if(this.dfForm.preDeptId=this.preSelectData,this.preSelectName==this.dfForm.deptName)return void this.$message({message:"上级部门不能与部门相同",type:"warning"});this.$refs.form.validate(function(e){if(!e)return t.$message.error("添加失败"),!1;t.$axios.post("api/Dept",a).then(function(e){var a=e.data;0==a.result?t.$message.error(a.tips):t.$message(a.tips),t.$emit("departFormSubmitSuccess")}).catch(function(e){console.log(e)})})}if("put"===this.formProps.methods){var r=this;void 0==this.preSelectData?this.dfForm.preDeptId=this.departMsg:this.dfForm.preDeptId=this.preSelectData,console.log(this.dfForm),r.$axios.put("api/Dept?deptId="+this.formProps.deptId,this.dfForm).then(function(t){var a=t.data;0==a.result?r.$message.error(a.tips):(r.$message({message:t.data.tips,type:"success"}),e.$emit("departFormSubmitSuccess"))}).catch(function(e){console.log(e)})}},dfClose:function(){this.$emit("dfClose")},resetForm:function(){this.$refs.form.resetFields()}},watch:{}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"depart-form"},[a("el-form",{ref:"form",attrs:{"label-width":"120px",model:e.dfForm,rules:e.dfRules}},[a("el-form-item",{attrs:{label:"上级部门名称",prop:"preDeptId"}},[a("el-input",{staticStyle:{display:"none"},model:{value:e.dfForm.preDeptId,callback:function(t){e.$set(e.dfForm,"preDeptId",t)},expression:"dfForm.preDeptId"}}),e._v(" "),a("xy-depart-tree-select",{attrs:{departMsg:e.departMsg},on:{transferDTSelect:e.getTreeSelectData,dtreeSelect:e.dTreeRowData}})],1),e._v(" "),a("el-form-item",{attrs:{label:"部门名称",prop:"deptName"}},[a("el-input",{attrs:{placeholder:"请输入部门名称"},model:{value:e.dfForm.deptName,callback:function(t){e.$set(e.dfForm,"deptName",t)},expression:"dfForm.deptName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"部门账号",prop:"deptAccount"}},[a("el-input",{attrs:{placeholder:"请输入部门登录账号"},model:{value:e.dfForm.deptAccount,callback:function(t){e.$set(e.dfForm,"deptAccount",t)},expression:"dfForm.deptAccount"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"部门密码",prop:"deptPsw"}},[a("el-input",{attrs:{placeholder:"请输入部门登录密码"},model:{value:e.dfForm.deptPsw,callback:function(t){e.$set(e.dfForm,"deptPsw",t)},expression:"dfForm.deptPsw"}})],1),e._v(" "),a("el-form-item",{staticStyle:{"text-align":"right"}},[a("el-button",{on:{click:e.dfClose}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var f={props:{departForm:{}},data:function(){var e=this;return{ruleForm2:{password:"",checkPass:""},rules2:{password:[{validator:function(t,a,r){""===a?r(new Error("请输入密码")):(""!==e.ruleForm2.checkPass&&e.$refs.ruleForm2.validateField("checkPass"),r())},trigger:"blur"}],checkPass:[{validator:function(t,a,r){""===a?r(new Error("请再次输入密码")):a!==e.ruleForm2.password?r(new Error("两次输入密码不一致!")):r()},trigger:"blur"}]}}},methods:{onPassSubmit:function(){var e=this,t=this;console.log(this.departForm),t.$axios.put("api/Dept/psw?deptId="+this.departForm.deptId+"&Password="+this.ruleForm2.password).then(function(a){var r=a.data;0==r.result?t.$message.error(r.tips):e.$message({showClose:!0,message:r.tips,type:"success"})}).catch(function(e){console.log(e)})}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",{ref:"ruleForm2",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm2,"status-icon":"",rules:e.rules2,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.ruleForm2.password,callback:function(t){e.$set(e.ruleForm2,"password",t)},expression:"ruleForm2.password"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"确认密码",prop:"checkPass"}},[a("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.ruleForm2.checkPass,callback:function(t){e.$set(e.ruleForm2,"checkPass",t)},expression:"ruleForm2.checkPass"}})],1)],1)},staticRenderFns:[]},b={name:"departManage",mounted:function(){},data:function(){return{modifyVisible:!1,addVisible:!1,resetVisible:!1,delVisible:!1,dminput:"",dfForm:"",departForm:{preDeptId:"",deptName:"",deptAccount:"",deptPsw:""},formProps:{method:"put"},tip:""}},components:{xyDepartTree:o,xyDepartTable:c,xyDepartForm:a("C7Lr")(u,m,!1,function(e){a("yKih")},"data-v-56568c9a",null).exports,xyDepartPass:a("C7Lr")(f,h,!1,null,null,null).exports},computed:{data:function(){}},methods:{dmLoadTableData:function(){this.$refs.dmTable.dmLoadTableData()},dmsearch:function(){this.$refs.dmTable.searchData()},getDmData:function(e){this.departForm=e,this.$refs.dmFrom&&this.$refs.dmFrom.loadData(e.deptId)},departFormSubmitSuccess:function(){this.$refs.dmTable.dmLoadTableData(),this.addVisible=!1},addHandle:function(){this.tip="部门新增",this.formProps.methods="post",this.addVisible=!0,this.$refs.dmFrom&&this.$refs.dmFrom.resetForm()},modifyVisibleFun:function(e){this.tip="部门修改",this.formProps=e,this.formProps.methods="put",this.$refs.dmFrom&&this.$refs.dmFrom.loadData(e.deptId),this.addVisible=!0},dfClose:function(){this.addVisible=!1},resetVisibleFun:function(e){this.resetVisible=e},onPassSubmit:function(){this.$refs.dmPass.onPassSubmit(),this.resetVisible=!1},nodeClickHandle:function(e,t,a){this.$refs.dmTable.searchData(e.deptName)}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"crumbs"},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("i",{staticClass:"el-icon-setting"}),e._v("部门管理")]),e._v(" "),a("el-breadcrumb-item",[e._v("部门管理")])],1)],1),e._v(" "),a("div",{staticClass:"container"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:4}},[a("el-container",{staticStyle:{"max-height":"636px"}},[a("el-main",[a("el-scrollbar",{staticClass:"custom-scrollbar",staticStyle:{"min-height":"587px"}},[a("xy-depart-tree",{ref:"unitTree",attrs:{checkStrictly:!0},on:{nodeClick:e.nodeClickHandle}})],1)],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:20}},[a("div",{staticClass:"handle-box"},[a("el-button",{staticClass:"handle-box-add",attrs:{icon:"el-icon-plus",type:"primary"},on:{click:e.addHandle}},[e._v("\n                        添加\n                    ")]),e._v(" "),a("div",{staticClass:"handle-search-box"},[a("span",[e._v("部门名称:")]),e._v(" "),a("el-input",{staticClass:"search",attrs:{size:"small",clearable:"",placeholder:"请输入关键字进行搜索"},on:{clear:e.dmLoadTableData},model:{value:e.dminput,callback:function(t){e.dminput=t},expression:"dminput"}}),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.dmsearch}},[e._v("搜索")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.dmLoadTableData}},[e._v("重置")])],1)],1),e._v(" "),a("xy-depart-table",{ref:"dmTable",attrs:{resetVisible:e.resetVisible,dminput:e.dminput},on:{dmEvent:e.getDmData,modifyVisibleChange:function(t){e.modifyVisibleFun(t)},resetVisibleChange:function(t){e.resetVisibleFun(t)}}})],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.tip,visible:e.addVisible,width:"30%"},on:{"update:visible":function(t){e.addVisible=t}}},[a("xy-depart-form",{ref:"dmFrom",attrs:{formProps:e.formProps,departForm:e.departForm},on:{departFormSubmitSuccess:e.departFormSubmitSuccess,dfClose:e.dfClose}})],1),e._v(" "),a("el-dialog",{attrs:{title:"重置密码",visible:e.resetVisible,width:"30%"},on:{"update:visible":function(t){e.resetVisible=t}}},[a("xy-depart-pass",{ref:"dmPass",attrs:{departForm:e.departForm}}),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.resetVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.onPassSubmit}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var v=a("C7Lr")(b,g,!1,function(e){a("bahY")},"data-v-20918804",null);t.default=v.exports},"UJ5+":function(e,t){},bahY:function(e,t){},"pI/d":function(e,t){},yKih:function(e,t){}});